# ğŸš€ Há»‡ Thá»‘ng Tá»± Äá»™ng ÄÄƒng BÃ i LÃªn Máº¡ng XÃ£ Há»™i

## ğŸ“‹ Tá»•ng Quan

Há»‡ thá»‘ng tá»± Ä‘á»™ng Ä‘Äƒng bÃ i viáº¿t, hÃ¬nh áº£nh, video lÃªn cÃ¡c ná»n táº£ng máº¡ng xÃ£ há»™i khi xuáº¥t báº£n bÃ i trÃªn website.

## ğŸ¯ TÃ­nh NÄƒng

### 1. **Admin Panel**
- âœ… Quáº£n lÃ½ káº¿t ná»‘i máº¡ng xÃ£ há»™i
- âœ… Cáº¥u hÃ¬nh auto-posting cho tá»«ng platform
- âœ… Xem lá»‹ch sá»­ Ä‘Äƒng bÃ i
- âœ… Retry failed posts
- âœ… Preview trÆ°á»›c khi Ä‘Äƒng
- âœ… Schedule Ä‘Äƒng bÃ i

### 2. **Platforms Há»— Trá»£**
- ğŸ”µ Facebook (Page, Group)
- ğŸ“¸ Instagram (Feed, Story, Reels)
- ğŸ¬ YouTube (Video, Shorts)
- ğŸ¦ Twitter/X
- ğŸ’¼ LinkedIn
- ğŸ“± TikTok
- ğŸ“Œ Pinterest
- ğŸ“± Zalo (OA)

### 3. **Content Types**
- ğŸ“ Text posts
- ğŸ–¼ï¸ Images (single/multiple)
- ğŸ¥ Videos
- ğŸ“Š Carousels
- ğŸ”— Links with preview

## ğŸ—ï¸ Kiáº¿n TrÃºc

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin UI (Next.js)                                      â”‚
â”‚  - Social Media Settings                                 â”‚
â”‚  - Platform Connections                                  â”‚
â”‚  - Post History & Analytics                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js API Routes                                      â”‚
â”‚  - /api/social-media/platforms                           â”‚
â”‚  - /api/social-media/posts                               â”‚
â”‚  - /api/social-media/webhooks                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Database (PostgreSQL + Prisma)                          â”‚
â”‚  - SocialMediaPlatform                                   â”‚
â”‚  - SocialMediaPost                                       â”‚
â”‚  - SocialMediaAccount                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n Workflows                                           â”‚
â”‚  - Post to Facebook                                      â”‚
â”‚  - Post to Instagram                                     â”‚
â”‚  - Post to YouTube                                       â”‚
â”‚  - Post to TikTok                                        â”‚
â”‚  - Post to Twitter/X                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Social Media APIs                                       â”‚
â”‚  - Facebook Graph API                                    â”‚
â”‚  - Instagram Graph API                                   â”‚
â”‚  - YouTube Data API                                      â”‚
â”‚  - Twitter API v2                                        â”‚
â”‚  - LinkedIn API                                          â”‚
â”‚  - TikTok API                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Database Schema

```prisma
// TÃ i khoáº£n máº¡ng xÃ£ há»™i
model SocialMediaAccount {
  id          String   @id
  platform    String   // facebook, instagram, youtube, etc
  accountName String
  accountId   String
  accessToken String?  // Encrypted
  refreshToken String? // Encrypted
  expiresAt   DateTime?
  isActive    Boolean  @default(true)
  settings    Json?    // Platform-specific settings
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  
  posts       SocialMediaPost[]
}

// BÃ i Ä‘Äƒng lÃªn máº¡ng xÃ£ há»™i
model SocialMediaPost {
  id              String   @id
  postId          String   // ID cá»§a bÃ i viáº¿t gá»‘c
  accountId       String   // Social media account
  platform        String   // facebook, instagram, etc
  status          String   // pending, processing, published, failed
  scheduledAt     DateTime?
  publishedAt     DateTime?
  platformPostId  String?  // ID trÃªn platform (Ä‘á»ƒ xÃ³a, edit sau)
  platformUrl     String?  // Link Ä‘áº¿n bÃ i Ä‘Äƒng
  content         Json     // Ná»™i dung Ä‘Ã£ customize cho platform
  media           Json?    // URLs cá»§a media
  error           String?
  retryCount      Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  
  account         SocialMediaAccount @relation(fields: [accountId], references: [id])
  Post            Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  @@index([postId])
  @@index([accountId])
  @@index([status])
}

// Template cho tá»«ng platform
model SocialMediaTemplate {
  id          String   @id
  platform    String
  name        String
  content     String   // Template vá»›i placeholders: {{title}}, {{excerpt}}, etc
  isDefault   Boolean  @default(false)
  settings    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

// Lá»‹ch sá»­ sync
model SocialMediaSync {
  id          String   @id
  operation   String   // post_created, post_published, post_deleted
  status      String   // success, failed, pending
  payload     Json
  response    Json?
  error       String?
  createdAt   DateTime @default(now())
}
```

## ğŸ”§ Admin UI Components

### 1. **Social Media Settings Page**
```
/admin/social-media/
â”œâ”€â”€ Dashboard
â”‚   â”œâ”€â”€ Connected Accounts
â”‚   â”œâ”€â”€ Recent Posts
â”‚   â””â”€â”€ Analytics
â”œâ”€â”€ Platforms
â”‚   â”œâ”€â”€ Connect New Platform
â”‚   â”œâ”€â”€ Manage Connections
â”‚   â””â”€â”€ Platform Settings
â”œâ”€â”€ Posts
â”‚   â”œâ”€â”€ Scheduled Posts
â”‚   â”œâ”€â”€ Published Posts
â”‚   â””â”€â”€ Failed Posts
â””â”€â”€ Templates
    â”œâ”€â”€ Create Template
    â””â”€â”€ Manage Templates
```

### 2. **Post Editor Integration**
- Toggle "Auto-post to social media"
- Select platforms
- Customize content per platform
- Schedule posting time
- Preview for each platform

## ğŸ”„ n8n Workflows

### Workflow 1: Main Post Publisher
```
Trigger (Webhook) 
  â†’ Validate Data
  â†’ Get Active Platforms
  â†’ For Each Platform:
      â†’ Transform Content
      â†’ Upload Media
      â†’ Publish Post
      â†’ Update Status
  â†’ Send Notification
```

### Workflow 2: Scheduled Posts
```
Cron (Every 5 minutes)
  â†’ Get Pending Scheduled Posts
  â†’ For Each Post:
      â†’ Check Time
      â†’ Trigger Publisher
      â†’ Update Status
```

### Workflow 3: Retry Failed Posts
```
Cron (Every hour)
  â†’ Get Failed Posts (retry < 3)
  â†’ For Each Post:
      â†’ Retry Publishing
      â†’ Update Retry Count
```

## ğŸ¨ UI Features

### Post Editor Enhancement
```tsx
<div className="social-media-section">
  <h3>Auto-Post to Social Media</h3>
  
  {/* Enable/Disable */}
  <Switch 
    checked={autoPost} 
    onChange={setAutoPost}
    label="Automatically post to social media"
  />
  
  {/* Platform Selection */}
  <div className="platforms">
    {platforms.map(platform => (
      <PlatformCard
        key={platform.id}
        platform={platform}
        enabled={selectedPlatforms.includes(platform.id)}
        onToggle={() => togglePlatform(platform.id)}
        onCustomize={() => customizeContent(platform.id)}
      />
    ))}
  </div>
  
  {/* Scheduling */}
  <DateTimePicker
    label="Schedule posting time"
    value={scheduledTime}
    onChange={setScheduledTime}
  />
  
  {/* Content Preview */}
  <Tabs>
    {selectedPlatforms.map(platformId => (
      <Tab key={platformId}>
        <PlatformPreview 
          platform={platformId}
          content={getContentForPlatform(platformId)}
        />
      </Tab>
    ))}
  </Tabs>
</div>
```

### Social Media Dashboard
```tsx
<Dashboard>
  {/* Stats */}
  <Stats>
    <Stat label="Connected Platforms" value={connectedCount} />
    <Stat label="Posts This Month" value={monthlyPosts} />
    <Stat label="Success Rate" value={successRate} />
    <Stat label="Pending Posts" value={pendingCount} />
  </Stats>
  
  {/* Recent Activity */}
  <RecentPosts limit={10} />
  
  {/* Platform Status */}
  <PlatformsList />
</Dashboard>
```

## ğŸ” Security & Permissions

### Role Permissions
```typescript
const PERMISSIONS = {
  // Social Media Management
  'social_media.view': ['ADMIN', 'EDITOR', 'MARKETING'],
  'social_media.connect': ['ADMIN', 'MARKETING'],
  'social_media.disconnect': ['ADMIN'],
  'social_media.post': ['ADMIN', 'EDITOR', 'MARKETING'],
  'social_media.schedule': ['ADMIN', 'EDITOR', 'MARKETING'],
  'social_media.delete': ['ADMIN'],
  'social_media.retry': ['ADMIN', 'MARKETING'],
  'social_media.analytics': ['ADMIN', 'MARKETING'],
}
```

## ğŸ“ Implementation Checklist

### Phase 1: Database & Schema
- [ ] Add Prisma models
- [ ] Run migrations
- [ ] Seed default templates

### Phase 2: API Routes
- [ ] `/api/social-media/accounts` (CRUD)
- [ ] `/api/social-media/posts` (CRUD)
- [ ] `/api/social-media/templates` (CRUD)
- [ ] `/api/social-media/publish` (Trigger n8n)
- [ ] `/api/social-media/webhooks` (n8n callbacks)

### Phase 3: n8n Workflows
- [ ] Create base workflow template
- [ ] Facebook posting workflow
- [ ] Instagram posting workflow
- [ ] YouTube posting workflow
- [ ] Scheduled posts workflow
- [ ] Retry failed posts workflow

### Phase 4: Admin UI
- [ ] Social Media Settings Page
- [ ] Platform Connection Flow
- [ ] Post History & Analytics
- [ ] Template Management
- [ ] Post Editor Integration

### Phase 5: Testing & Optimization
- [ ] Test each platform
- [ ] Error handling
- [ ] Rate limiting
- [ ] Queue management
- [ ] Analytics tracking

## ğŸš€ Quick Start

```bash
# 1. Cáº­p nháº­t Prisma schema
cd conphung
npx prisma migrate dev --name add_social_media

# 2. Khá»Ÿi Ä‘á»™ng n8n
docker-compose up -d n8n

# 3. Import workflows vÃ o n8n
# Truy cáº­p http://localhost:5678
# Import workflows tá»« /n8n/workflows/

# 4. Cáº¥u hÃ¬nh environment
echo "N8N_WEBHOOK_URL=http://localhost:5678/webhook/social-media-publish" >> .env
echo "N8N_WEBHOOK_SECRET=your-secret-here" >> .env

# 5. Cháº¡y seed
npm run db:seed
```

## ğŸ“š Resources

- [Facebook Graph API](https://developers.facebook.com/docs/graph-api)
- [Instagram Graph API](https://developers.facebook.com/docs/instagram-api)
- [YouTube Data API](https://developers.google.com/youtube/v3)
- [Twitter API](https://developer.twitter.com/en/docs/twitter-api)
- [n8n Documentation](https://docs.n8n.io/)

---

**Next Steps:** Báº¡n muá»‘n tÃ´i implement phase nÃ o trÆ°á»›c?
1. Database Schema & Migrations
2. Admin UI Pages
3. n8n Workflows
4. API Routes
